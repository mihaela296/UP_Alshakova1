<Window x:Class="UP_Alshakova.ClientWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Товары - Клиент" 
        Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource PrimaryBackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Шапка -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="{StaticResource SecondaryBackgroundBrush}" 
                    Height="50" VerticalAlignment="Center">
            <TextBlock Text="Товары - Клиент" Style="{StaticResource HeaderTextBlockStyle}" 
                      VerticalAlignment="Center" Margin="10,0"/>

            <Button x:Name="btnProfile" Content="Профиль" Click="btnProfile_Click" 
                    Style="{StaticResource AccentButtonStyle}" Margin="20,0,0,0"/>
            <Button x:Name="btnChangePassword" Content="Сменить пароль" Click="btnChangePassword_Click" 
                    Style="{StaticResource AccentButtonStyle}" Margin="10,0,0,0"/>

            <!-- ФИО пользователя -->
            <TextBlock x:Name="txtUserInfoHeader" Style="{StaticResource BaseTextBlockStyle}" 
                      VerticalAlignment="Center" Margin="300,0,0,0" FontWeight="Bold"/>

            <Button x:Name="btnBack" Content="Выйти" Click="btnBack_Click" 
                    Style="{StaticResource AccentButtonStyle}" Margin="10,0,0,0"/>
        </StackPanel>

        <!-- Список товаров -->
        <ScrollViewer Grid.Row="1" Margin="10">
            <ItemsControl x:Name="itemsProducts">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="Gray" BorderThickness="1" Margin="0,5" Padding="10"
                                Background="{Binding BackgroundColor}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="150"/>
                                </Grid.ColumnDefinitions>

                                <!-- Фото товара -->
                                <Image Grid.Column="0" Source="{Binding ImagePath}" Width="80" Height="80" 
                                       Stretch="Uniform"/>

                                <!-- Основная информация -->
                                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                    <TextBlock Text="{Binding CategoryName}" FontWeight="Bold" 
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                    <TextBlock Text="{Binding ProductName}" FontWeight="Bold"
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                    <TextBlock Text="{Binding Description}" 
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                    <TextBlock Text="{Binding Manufacturer}" 
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                    <TextBlock Text="{Binding Supplier}" 
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                </StackPanel>

                                <!-- Цены и информация справа -->
                                <StackPanel Grid.Column="2" Margin="10,0,0,0" HorizontalAlignment="Right">
                                    <!-- Цены - ИСПРАВЛЕННЫЙ БЛОК -->
                                    <StackPanel Orientation="Horizontal">
                                        <!-- Оригинальная цена с зачеркиванием (только при скидке) -->
                                        <TextBlock Margin="0,0,5,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
                                                    <Setter Property="Text" Value="{Binding Price, StringFormat={}{0:0.00}}"/>
                                                    <Setter Property="Foreground" Value="{StaticResource RedBrush}"/>
                                                    <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasDiscount}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <!-- Итоговая цена (всегда черная жирная) -->
                                        <TextBlock>
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Setter Property="Text" Value="{Binding FinalPrice, StringFormat={}{0:0.00}}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasDiscount}" Value="False">
                                                            <!-- Если скидки нет, показываем обычную цену -->
                                                            <Setter Property="Text" Value="{Binding Price, StringFormat={}{0:0.00}}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Количество и единица измерения -->
                                    <TextBlock Text="{Binding UnitName}" 
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                    <TextBlock Text="{Binding StockQuantity, StringFormat={}{0} шт.}" 
                                               Style="{StaticResource BaseTextBlockStyle}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Window>